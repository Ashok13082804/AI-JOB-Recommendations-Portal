{% extends 'base.html' %}

{% block title %}Post a Job{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; padding: var(--space-8) var(--space-4);">
    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-plus-circle"></i> Post a New Job</h3>
            <p class="text-muted mb-0">Fill in the details to post a job opening</p>
        </div>

        <form id="create-job-form">
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label">Job Title *</label>
                    <input type="text" name="title" class="form-input" placeholder="e.g., Senior Frontend Developer"
                        required>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="form-label">Company Name</label>
                        <input type="text" name="company" class="form-input"
                            value="{{ current_user.company_name or '' }}" placeholder="Your company name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" name="location" class="form-input" placeholder="e.g., Bangalore, Remote">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="form-label">Job Type</label>
                        <select name="job_type" class="form-select">
                            <option value="full-time">Full-time</option>
                            <option value="part-time">Part-time</option>
                            <option value="contract">Contract</option>
                            <option value="remote">Remote</option>
                            <option value="internship">Internship</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Experience Required</label>
                        <div class="flex gap-2 items-center">
                            <input type="number" name="experience_min" class="form-input" placeholder="Min" min="0"
                                style="width: 80px;">
                            <span>to</span>
                            <input type="number" name="experience_max" class="form-input" placeholder="Max" min="0"
                                style="width: 80px;">
                            <span>years</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Salary Range (Annual, INR)</label>
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <input type="number" name="salary_min" class="form-input"
                                placeholder="Minimum (e.g., 600000)">
                        </div>
                        <div class="flex-1">
                            <input type="number" name="salary_max" class="form-input"
                                placeholder="Maximum (e.g., 1200000)">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Job Description *</label>
                    <textarea name="description" class="form-textarea" rows="6"
                        placeholder="Describe the role, responsibilities, and what you're looking for..."
                        required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Requirements</label>
                    <textarea name="requirements" class="form-textarea" rows="4"
                        placeholder="List the key requirements, qualifications, and nice-to-haves..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Required Skills</label>
                    <div id="skills-container" class="skills-grid mb-2"></div>
                    <div class="flex gap-2">
                        <input type="text" id="skill-input" class="form-input" placeholder="Add a skill (press Enter)">
                        <button type="button" class="btn btn-secondary" onclick="addSkill()">Add</button>
                    </div>
                    <small class="text-muted">Add skills that are required or preferred for this role</small>
                    <input type="hidden" name="skills" id="skills-hidden">
                </div>
            </div>

            <div class="card-footer flex justify-end gap-4">
                <a href="{{ url_for('dashboard') }}" class="btn btn-ghost">Cancel</a>
                <button type="button" class="btn btn-secondary" onclick="previewJob()">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Post Job
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Skills management
    const skillsContainer = document.getElementById('skills-container');
    const skillInput = document.getElementById('skill-input');
    const skillsHidden = document.getElementById('skills-hidden');
    const skills = [];

    function updateHiddenSkills() {
        skillsHidden.value = skills.join(',');
    }

    function addSkill() {
        const skill = skillInput.value.trim();
        if (!skill || skills.includes(skill)) {
            skillInput.value = '';
            return;
        }

        skills.push(skill);

        const badge = document.createElement('span');
        badge.className = 'skill-badge';
        badge.innerHTML = `
        ${skill}
        <button type="button" onclick="removeSkill('${skill}', this)" style="background: none; border: none; cursor: pointer; margin-left: 4px; color: inherit;">
            <i class="fas fa-times"></i>
        </button>
    `;

        skillsContainer.appendChild(badge);
        skillInput.value = '';
        updateHiddenSkills();
    }

    function removeSkill(skill, btn) {
        const index = skills.indexOf(skill);
        if (index > -1) {
            skills.splice(index, 1);
            btn.parentElement.remove();
            updateHiddenSkills();
        }
    }

    skillInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            addSkill();
        }
    });

    // Form submission
    document.getElementById('create-job-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch('/jobs/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (result.success) {
                showToast('Job posted successfully!', 'success');
                window.location.href = `/jobs/${result.job_id}`;
            } else {
                showToast(result.message || 'Error posting job', 'error');
            }
        } catch (error) {
            showToast('An error occurred', 'error');
        }
    });

    function previewJob() {
        // Simple preview - could be enhanced with modal
        alert('Preview feature coming soon!');
    }
</script>
{% endblock %}